"use strict";function Author(){this.id="",this.delay=0,this.created=0,this.karma=0,this.about="",this.submitted=[]}function DisplayViewItem(){this.title="",this.url="",this.time=0,this.score=0,this.id="",this.karma=0,this.set=function(a,b){this.title=a.title,this.url=a.url,this.time=helper.convertUnixTimeToLocalFormat(a.time),this.score=a.score,this.id=b.id,this.karma=b.karma}}function Story(){this.id=0,this.deleted=!0,this.type="",this.by="",this.time=0,this.text="",this.dead=!0,this.parent=0,this.kids=[],this.url="",this.score=0,this.title="",this.parts=[],this.descendants=0}function getTopStoriesUrl(){return"https://hacker-news.firebaseio.com/v0/topstories.json"}function getAuthorUrl(a){return"https://hacker-news.firebaseio.com/v0/user/"+a+".json"}function getStoryUrl(a){return"https://hacker-news.firebaseio.com/v0/item/"+a+".json"}function createAndFillTableData(a){var b=document.createElement("TR"),c=document.createElement("TD"),d=document.createElement("TD"),e=document.createElement("TD"),f=document.createElement("TD"),g=document.createElement("TD"),h=document.createElement("TD");return c.appendChild(document.createTextNode(a.title)),d.appendChild(createURLTags(a.url)),e.appendChild(document.createTextNode(a.time)),f.appendChild(document.createTextNode(a.score)),g.appendChild(document.createTextNode(a.id)),h.appendChild(document.createTextNode(a.karma)),b.appendChild(c),b.appendChild(d),b.appendChild(e),b.appendChild(f),b.appendChild(g),b.appendChild(h),b}function createURLTags(a){var b=document.createElement("A");return b.setAttribute("href",a),b.setAttribute("target","_blank"),b.appendChild(document.createTextNode(a)),b}function createAndFillTableHeader(){var a=document.createElement("TR");return tableHeading.forEach(function(b){var c=document.createElement("TH");c.appendChild(document.createTextNode(b)),a.appendChild(c)}),a}var transport={get:function(a,b){var c=new XMLHttpRequest;c.onreadystatechange=function(){4==c.readyState&&200==c.status&&b(c.responseText)},c.open("GET",a,!0),c.send(null)}},helper={pickRandomDataFromArray:function(a,b){for(var c=[],d=0;d<b;d++){var e=Math.floor(Math.random()*a.length);c.push(a[e]),a.splice(e,1)}return c},convertUnixTimeToLocalFormat:function(a){return new Date(1e3*a)},sortStoriesByScores:function(a,b){return a.score===b.score?0:a.score>b.score?1:-1}},tableHeading=["Story title","Story URL","Story timestamp","Story score","Author id","Author karma score"],maximumStoriesToPick=10,tableTemplateCreator={createAndPopulateTableTemplate:function(a){var b=document.createElement("TABLE");b.setAttribute("id","storyTable");var c=document.createElement("TABLE");return c.appendChild(createAndFillTableHeader()),a.forEach(function(a){c.appendChild(createAndFillTableData(a))}),b.appendChild(c),b}},fetchTopStoriesData=function(){transport.get(getTopStoriesUrl(),function(a){var b=helper.pickRandomDataFromArray(JSON.parse(a),maximumStoriesToPick),c=0,d=[];b.forEach(function(a){transport.get(getStoryUrl(a),function(a){var b=new Story;b=JSON.parse(a),transport.get(getAuthorUrl(b.by),function(a){var e=new Author;e=JSON.parse(a);var f=new DisplayViewItem;if(f.set(b,e),d.push(f),c++,c===maximumStoriesToPick){d.sort(helper.sortStoriesByScores);var g=document.getElementsByClassName("spinner");if(g&&g.length>0&&"spinner"==g[0].getAttribute("class")){g[0].setAttribute("class","nospinner");var h=document.getElementById("listStories");h.appendChild(tableTemplateCreator.createAndPopulateTableTemplate(d))}}})})})})};fetchTopStoriesData();var refreshButton=document.getElementById("refresh");refreshButton.onclick=function(){var a=document.getElementsByClassName("nospinner");if(a.length>0&&"nospinner"==a[0].getAttribute("class")){a[0].setAttribute("class","spinner");for(var b=document.getElementById("listStories");b.firstChild;)b.removeChild(b.firstChild);fetchTopStoriesData()}};